---
title: "Verneuil Disease_Analysis"
author: "Nansseu JR"
date: "2025-10-23"
output: html_document
editor_options: 
  chunk_output_type: console
---

<style>
body {
text-align: justify}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
```

# Présentation

Cette analyse présente les résultats d'une étude transversale descriptive sur le profil épidémiologique et clinique de la **Maladie de Verneuil** au sein d'une population noire africaine. Les analyses sont faites à l'aide de R version 4.5.2 (R Core Team, 2025, R Foundation for Statistical Computing, Vienna, Austria) [ref](https://www.R-project.org/). Les données qualitatives sont résumées par les fréquences et pourcentages. tandis que les données quantitatives le sont par la moyenne +/- écart-type (ET) ou médiane (intervalle inter-quartile, IIQ) selon que la variable suit ou non une distribution normale. La normalité a été évaluée par le test de Shapiro-Wilk. Tableaux et figures servent à la présentation de ces résumés. Les tests non-paramétriques de Wilcoxon et Kruskal-Wallis ont été utilisés pour la comparaison de variables quantitatives tandis que le test de Chi-2 ou le test exact de Fisher ont été utilisés pour comparer les variables qualitatives, avec un seuil de significativité fixé à p < 0,05.

# Importation des packages et de la base des données

```{r echo = F}
# Importing the packages
if(!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse,
               dplyr,
               forcats,
               gtsummary,
               reactable,
               Rtools44,
               here,
               janitor,
               readxl,
               ggplot2,
               plotly,
               ggrepel,
               flextable,
               kableExtra,
               ggalluvial)

# Importing the dataset
mdv <- read_xlsx(
  path = here("data/maladie_de_verneuil_3.xlsx"),
  sheet = "Maladie de Verneuil",
  range = "A1:AI50",
  col_names = TRUE) %>% 
  clean_names()
```

La base de données importée dispose de `r ncol(mdv)` 35 variables pour `r nrow(mdv)` observations. Les analyses qui suivent sont donc présentées pour un total de **`r nrow(mdv)`** patients.

# Configuration des données

Le tableau ci-dessous présente les différentes fréquences absolues et pourcentages de chaque modalité des variables renseignées.

```{r}
#Summary table of variables
# mdv %>%
#   tbl_summary() #%>%
# # #   as_kable() %>%  ##importer le package kableExtra
# #   kable_styling()
# # # #OR
mdv %>%
  tbl_summary() %>%
  as_flex_table()
```

# Analyses univariées

## Distribution d'âge et sexe

```{r}
# Normality test on age
shapiro.test(mdv$age_annees) ##W = 0.98525, p-value = 0.7918

#Age summary
summary(mdv$age_annees)
sd(mdv$age_annees)

# Defining age categories
mdv <- mdv %>% 
  mutate(tranche_age = case_when(
    age_annees>=10 & age_annees<20 ~ "10-19",
    age_annees>=20 & age_annees<30 ~ "20-29",
    age_annees>=30 & age_annees<40 ~ "30-39",
    age_annees>=40 & age_annees<50 ~ "40-49",
    age_annees>=50 & age_annees<60 ~ "50-59",
    age_annees>=60 ~ "60+"
  ))

#Summary table of "tranches d'âge"
mdv %>% 
  count(tranche_age) %>% 
  mutate(pct = round(n/sum(n)*100, digits = 1)) %>% 
  reactable()

```

```{r}
# Figure showing age distribution
# fig1 <- 
#   mdv %>% 
#   count(tranche_age) %>% 
#   arrange(desc(n)) %>% 
#   ggplot(mapping = aes(x = tranche_age,
#                        y = n,
#                        fill = tranche_age)) +
#   geom_col(linewidth = 0.5,
#            color = "white",
#            width = 1) + 
#   geom_text(mapping = aes(label = n),
#             position = position_stack(vjust = 0.5),
#             color = "white",
#             fontface = "bold",
#             size = 4) +
#   labs(x = "Tranche d'âge (années)",
#        y = "Nombre de patients") +
#   theme(legend.position = "none")
# 
# fig1

fig1 <- 
  mdv %>% 
  count(tranche_age) %>% 
  arrange(desc(n)) %>% 
  ggplot(mapping = aes(x = tranche_age,
                       y = n)) +
  geom_col(fill = "#1f78b4",
           position = "stack",
           linewidth = 0.5,
           color = "white",
           width = 1) + 
  geom_text(mapping = aes(label = n,
                          y = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Tranche d'âge (années)",
       y = "Nombre de patients") +
  theme(legend.position = "none") +
  theme_minimal()

fig1

```

```{r}
#Saving age distribution
ggsave(plot = fig1,
       filename = here("outputs/Figure_1.jpg"),
       width = 8,
       height = 6)
```

```{r}
fig1b <- 
  mdv %>% 
  count(tranche_age) %>% 
  arrange(desc(n)) %>% 
  ggplot(mapping = aes(x = tranche_age,
                       y = n)) +
  geom_col(fill = "forestgreen",
           position = "stack",
           linewidth = 0.5,
           color = "white",
           width = 1) + 
  geom_text(mapping = aes(label = n,
                          y = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Tranche d'âge (années)",
       y = "Nombre de patients") +
  theme(legend.position = "none") +
  theme_minimal()

fig1b

#Saving age distribution
ggsave(plot = fig1b,
       filename = here("outputs/Figure_1b.jpg"),
       width = 8,
       height = 6)

```

Les âges des patients varient de 10 à 63 ans, avec une moyenne de 34,5 +/- 10,2 ans. La tranche d'âge la plus représentée est celle des 30-39 ans (n = 21; 42,9%), suivie des 20-29 ans (n = 13; 26,5%).

Les femmes (n = 29; 59,2%)) représentent près de 3/5 des patients.

## Motifs de consultation

```{r}
## Transformation de la variable motif_de_consultation pour compter toutes les occurrences
result1 <- 
  mdv %>%
  mutate(motif_de_consultation = str_remove(motif_de_consultation, "\\s*\\([^\\)]+\\)")) %>% 
##Explications :
### \\s* supprime les espaces éventuels avant la parenthèse ouvrante,
### \$$ et \$$ échappent les parenthèses,
### [^\$$] + signifie "tout ce qui n’est pas une parenthèse fermante" entre les parenthèses.
### Ce code supprime donc toute expression entre parenthèses avec son espace précédent, ce qui laisse juste "Douleur" si la chaîne initiale était "Douleur(préciser l'intensité)" ou "Douleur (préciser l'intensité)" avec ou sans espace avant.
  separate_rows(motif_de_consultation, sep = "  ") %>% 
  count(motif_de_consultation) 

#Motifs in a table
result1 %>% 
  mutate(pct = round(n/49*100, digits = 1)) %>% 
  arrange(desc(n)) %>% 
  reactable()

```

```{r}
# Figure displaying various "motifs de consultation"
# fig2 <- 
#   ggplot(data = result1,
#          mapping = aes(y = fct_reorder(motif_de_consultation, n, .desc = FALSE), #classe par ordre croissant
#                        x = n,
#                        fill = motif_de_consultation)) +
#   geom_col(linewidth = 0.3,
#            color = "white") + 
#   geom_text(mapping = aes(label = n),
#             position = position_stack(vjust = 0.5),
#             color = "white",
#             fontface = "bold",
#             size = 4) +
#   labs(x = "Nombre de patients",
#        y = "Motifs de consultation") +
#   theme(legend.position = "none")
# 
# fig2

fig2 <- 
  ggplot(data = result1,
         mapping = aes(y = fct_reorder(motif_de_consultation, n, .desc = FALSE), #classe par ordre croissant
                       x = n)) +
  geom_col(fill = "#1f78b4",
           linewidth = 0.3,
           color = "white") + 
  geom_text(mapping = aes(label = n,
                          x = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Nombre de patients",
       y = "Motifs de consultation") +
  theme(legend.position = "none") +
  theme_minimal()

fig2
```

```{r}
#Saving Fig 2
ggsave(plot = fig2,
       filename = here("outputs/Figure_2.jpg"),
       width = 8,
       height = 6)
```

```{r}
fig2b <- 
  ggplot(data = result1,
         mapping = aes(y = fct_reorder(motif_de_consultation, n, .desc = FALSE), #classe par ordre croissant
                       x = n)) +
  geom_col(fill = "forestgreen",
           linewidth = 0.3,
           color = "white") + 
  geom_text(mapping = aes(label = n,
                          x = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Nombre de patients",
       y = "Motifs de consultation") +
  theme(legend.position = "none") +
  theme_minimal()

fig2b

#Saving Fig 2b
ggsave(plot = fig2b,
       filename = here("outputs/Figure_2b.jpg"),
       width = 8,
       height = 6)
```

Les lésions solides (n = 35; 71,4%) représentent le motif de consultation le plus récurrent, suivies de la douleur (n = 20; 40,8%). Pas mois d'un patient sur deux (n = 25; 51,0%) présentent deux motifs de consultation.

```{r}
# # Figure displaying Motifs de consultation
# fig2 <- 
#   ggplot(data = mdv,
#        mapping = aes(y = fct_infreq(motif_de_consultation),
#                      fill = motif_de_consultation)) + 
#   geom_bar(color = "white") + 
#   geom_text(stat = "count",
#             mapping = aes(label = ..count..),
#             color = "black",
#             hjust = -0.5,
#             fontface = "bold") +
#   labs(x = "Nombre de patients",
#        y = "Motifs de consultation") +
#   theme(legend.position = "none")
# 
# fig2
```

## Délai d'évolution

```{r}
# Normality test on "délai d'évolution"
shapiro.test(mdv$delai_devolution_en_mois) # W = 0.83295, p-value = 1.999e-05; cette variable n'est pas normale

summary(mdv$delai_devolution_en_mois)

```

Pour les 43 patients dont les données sont disponibles, le délai d'évolution de la maladie varie de 0 à 120 mois, avec une médiane de 24 mois (IQR 7-48).

```{r}
# Splitting delai d'evolution into classes
mdv <- mdv %>% 
  mutate(evolution_class = case_when(
    delai_devolution_en_mois <= 11 ~ "0-11",
    delai_devolution_en_mois >11 & delai_devolution_en_mois<=23 ~ "12-23",
    delai_devolution_en_mois >23 & delai_devolution_en_mois<=35 ~ "24-35",
    delai_devolution_en_mois >35 & delai_devolution_en_mois<=47 ~ "36-47",
    delai_devolution_en_mois >47 & delai_devolution_en_mois<=59 ~ "48-59",
    delai_devolution_en_mois >=60 ~ "60+"
  ))

#Creating an histogram for evolution_class
# fig3 <- 
#   mdv %>% 
#   filter(!is.na(delai_devolution_en_mois)) %>% 
#   count(evolution_class) %>% 
#   arrange(desc(n)) %>% 
#   ggplot(mapping = aes(x = evolution_class,
#                        y = n,
#                        fill = evolution_class)) +
#   geom_col(linewidth = 0.5,
#            color = "white",
#            width = 1) + 
#   geom_text(mapping = aes(label = n),
#             position = position_stack(vjust = 0.5),
#             color = "white",
#             fontface = "bold",
#             size = 4) +
#   labs(x = "Durée d'évolution de la maladie (mois)",
#        y = "Nombre de patients (n = 43") +
#   theme(legend.position = "none")
# 
# fig3

fig3 <- 
  mdv %>% 
  filter(!is.na(delai_devolution_en_mois)) %>% 
  count(evolution_class) %>% 
  arrange(desc(n)) %>% 
  ggplot(mapping = aes(x = evolution_class,
                       y = n)) +
  geom_col(fill = "#1f78b4",
           linewidth = 0.5,
           color = "white",
           width = 1) + 
  geom_text(mapping = aes(label = n,
                          y = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Durée d'évolution de la maladie (mois)",
       y = "Nombre de patients (n = 43") +
  theme(legend.position = "none") + 
  theme_minimal()

fig3

```

```{r}
#Saving Fig 3
ggsave(plot = fig3,
       filename = here("outputs/Figure_3.jpg"),
       width = 8,
       height = 6)
```

```{r}
fig3b <- 
  mdv %>% 
  filter(!is.na(delai_devolution_en_mois)) %>% 
  count(evolution_class) %>% 
  arrange(desc(n)) %>% 
  ggplot(mapping = aes(x = evolution_class,
                       y = n)) +
  geom_col(fill = "forestgreen",
           linewidth = 0.5,
           color = "white",
           width = 1) + 
  geom_text(mapping = aes(label = n,
                          y = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Durée d'évolution de la maladie (mois)",
       y = "Nombre de patients (n = 43") +
  theme(legend.position = "none") + 
  theme_minimal()

fig3b

#Saving Fig 3b
ggsave(plot = fig3b,
       filename = here("outputs/Figure_3b.jpg"),
       width = 8,
       height = 6)
```

## Facteurs de risque retrouvé

```{r}
# Transforming facteur de risque to count all occurrences
result2 <- 
  mdv %>% 
  mutate(facteurs_de_risque = case_when(
    facteurs_de_risque == "Non précisé" ~ "Non_précisé",
    TRUE ~ facteurs_de_risque
  )) %>% 
  separate_rows(facteurs_de_risque, sep = " ") %>% 
  mutate(facteurs_de_risque = case_when(
    facteurs_de_risque == "Non_précisé" ~ "Non précisé",
    TRUE ~ facteurs_de_risque
  )) %>% 
#Preparing the data for plotting
  count(facteurs_de_risque) %>% 
  mutate(facteurs_de_risque = fct_reorder(facteurs_de_risque, n, .desc = TRUE)) %>%
  arrange(desc(n)) %>%
  mutate(
    pct = round(n / nrow(mdv) * 100, digits = 1),
    #defining the positions for the labels to add
    csum = rev(cumsum(rev(n))),
    pos = n / 2 + lead(csum, 1),
    pos = if_else(is.na(pos), n / 2, pos)
  )

result2 %>% 
  reactable()

```

```{r}
#Pie chart showing identified potential risk factors
fig4 <- 
  ggplot(data = result2,
         mapping = aes(x = 4,
                       y = n,
                       fill = facteurs_de_risque)) +
  geom_col(color = "white",
           linewidth = 1) +
  coord_polar(theta = "y") +
  geom_label_repel(data = result2,
                   aes(y = pos,
                       label = paste(pct, "%")),
                   size = 4,
                   color = "black",
                   fontface = "bold",
                   nudge_x = 1,
                   show.legend = F) +
  labs(fill = "Facteur d'exposition") +
  theme_void()

fig4

```

```{r}
#Saving the figure
ggsave(plot = fig4,
       filename = here("outputs/Figure_4.jpg"),
       width = 8,
       height = 6)
```

```{r}
# Donut chart showing facteurs d'exposition
 fig4_2 <- 
  ggplot(result2,
         aes(x = 2,
             y = n,
             fill = facteurs_de_risque)) +
  geom_col(position = "fill",
           color = "white",
           linewidth = 1) +
  geom_text(aes(label = paste0(pct, "%")), #adding the labels
            position = position_fill(vjust = 0.5),
            color = "black",
            fontface = "bold",
            show.legend = F,
            size = 5
            ) +
  coord_polar(theta = "y") +
  xlim(c(0.2, 2 + 0.5)) +
  labs(fill = "Facteur d'exposition") +
  theme_void()

fig4_2
```

```{r}
#Saving the figure
ggsave(plot = fig4_2,
       filename = here("outputs/Figure_4b.jpg"),
       width = 8,
       height = 6)
```

Globalement, trois potentiels facteurs d'exposition sont retrouvés, notamment l'obésité (n = 7; 14,3%), l'hérédité (n = 5; 10,2%) et le tabac (n = 4; 8,2%). Un patient (2,0%) présente deux facteurs d'exposition (obésité et tabac). Cependant, aucun facteur d'exposition n'est retrouvé chez la majorité des patients (n = 29; 59,2%).

## Siège de début des lésions

```{r}
#Preparing the data for plotting
result3 <- 
  mdv %>%
  mutate(siege_de_debut = case_when(
    siege_de_debut == "Non précisé" ~ "Non_précisé",
    TRUE ~ siege_de_debut
  )) %>% 
  separate_rows(siege_de_debut, sep = " ") %>% 
  mutate(siege_de_debut = case_when(
    siege_de_debut == "Non_précisé" ~ "Non précisé",
    TRUE ~ siege_de_debut
  )) %>% 
  count(siege_de_debut) %>% 
  mutate(siege_de_debut = fct_reorder(siege_de_debut, n, .desc = TRUE)) %>%
  arrange(desc(n)) %>%
  mutate(pct = round(n/nrow(mdv)*100, digits = 1), #je fais diviser parnrow car il y a des patients avec plus d'un site 
        #defining the positions for the labels to add
         csum = rev(cumsum(rev(n))), 
         pos = n/2 + lead(csum, 1),
         pos = if_else(is.na(pos), n/2, pos)
         ) 

result3 %>% 
  reactable()

```

```{r}
#Pie chart showing initial sites of lesions
fig5 <- 
  ggplot(data = result3,
         mapping = aes(x = 4,
                       y = n,
                       fill = siege_de_debut)) +
  geom_col(color = "white",
           linewidth = 1) +
  coord_polar(theta = "y") +
  geom_label_repel(data = result3,
                   aes(y = pos,
                       label = paste0(pct, "%")),
                   size = 4,
                   color = "black",
                   fontface = "bold",
                   nudge_x = 1,
                   show.legend = F) +
  labs(fill = "Siège de début") +
  theme_void() 

fig5

```

```{r}
#Saving Fig5
ggsave(plot = fig5,
       filename = here("outputs/Figure_5.jpg"),
       width = 8,
       height = 6)
```

```{r}
fig5_2 <- 
  ggplot(result3,
         aes(x = 2,
             y = n,
             fill = siege_de_debut)) +
  geom_col(position = "fill",
           color = "white",
           linewidth = 1) +
  geom_text(aes(label = paste0(pct, "%")), #adding the labels
            position = position_fill(vjust = 0.5),
            color = "black",
            fontface = "bold",
            show.legend = F,
            size = 4
            ) +
  coord_polar(theta = "y") +
  xlim(c(0.2, 2 + 0.5)) +
  labs(fill = "Siège de début") +
  theme_void()

fig5_2
```

```{r}
#Saving Fig5b
ggsave(plot = fig5_2,
       filename = here("outputs/Figure_5b.jpg"),
       width = 8,
       height = 6)
```

Au début de la maladie, les lésions sont majoritairement situées/localisées aux aisselles, en l'occurrence chez 36 patients (73,5%), suivies du visage, notamment chez cinq (10,2%) patients. Trois patients (6,1%) ont des lésions sur deux sites.

```{r}
# # Displaying the distribution of initial sites of lesions with a different plot
# fig5_2 <- 
#   ggplot(data = mdv,
#          mapping = aes(y = fct_infreq(siege_de_debut))) + 
#   geom_bar(color = "white",
#            fill = "#1f78b4") + 
#   geom_text(stat = "count",
#             mapping = aes(label = ..count..),
#             color = "black",
#             hjust = -0.5,
#             fontface = "bold") +
#   labs(x = "Nombre de patients",
#        y = "Siège initial des lésions") +
#   theme(legend.position = "none") +
#   scale_y_discrete(limits = rev)  # Pour que la barre la plus haute soit en haut
# 
# fig5_2
# 
# #Saving the figure in a jpg format
# ggsave(plot = fig5_2,
#        filename = here("outputs/Figure_4_2.jpg"),
#        width = 8,
#        height = 6)

```

```{r}
# # Diviser siege_de_debut en deux variables
# # Séparer la variable en deux colonnes (par espace)
# mdv <- mdv %>% 
#   mutate(siege_de_debut = case_when(
#     siege_de_debut == "Non précisé" ~ "Non_précisé",
#     TRUE ~ siege_de_debut
#   ))
# 
# split_df <- data.frame(do.call(rbind, strsplit(as.character(mdv$siege_de_debut), " ")))
# 
# # Renommer les colonnes
# colnames(split_df) <- c("site1", "site2")
# 
# # Ajouter les colonnes séparées au data frame original
# mdv <- cbind(mdv, split_df)


# # Displaying the distribution of initial sites of lesions with a different plot & format
# fig5_3 <- 
#   ggplot(data = mdv,
#          mapping = aes(y = fct_infreq(siege_de_debut),
#                        fill = siege_de_debut)) + 
#   geom_bar(color = "white") + 
#   geom_text(stat = "count",
#             mapping = aes(label = ..count..),
#             color = "black",
#             hjust = -0.5,
#             fontface = "bold") +
#   labs(x = "Nombre de patients",
#        y = "Siège initial des lésions") +
#   theme(legend.position = "none") +
#   scale_y_discrete(limits = rev)  # Pour que la barre la plus haute soit en haut
# 
# fig5_3
# 
# #Saving the figure in a jpg format
# ggsave(plot = fig5_3,
#        filename = here("outputs/Figure_5_3.jpg"),
#        width = 8,
#        height = 6)
```

## Siège actuel des lésions

```{r}
result4 <- 
  mdv %>% 
  mutate(sieges = str_remove(sieges, "\\s*\\([^\\)]+\\)")) %>%
  separate_rows(sieges, sep = "  ") %>% 
  count(sieges) %>% 
  arrange(desc(n)) %>%
  mutate(pct = round(n/nrow(mdv)*100, digits = 1), #je fais diviser parnrow car il y a des patients avec plus d'un site 
        #defining the positions for the labels to add
         csum = rev(cumsum(rev(n))), 
         pos = n/2 + lead(csum, 1),
         pos = if_else(is.na(pos), n/2, pos)
         ) 

result4 %>% 
  reactable()

```

```{r}
#Bar chart showing the distribution of current sites of lesions
# fig6 <-
#   ggplot(data = mdv,
#          mapping = aes(y = sieges,
#                        fill = sieges)) +
#   geom_bar(color = "white") +
#   geom_text(stat = "count",
#             mapping = aes(label = ..count..),
#             color = "black",
#             hjust = -0.5,
#             fontface = "bold") +
#   labs(x = "Nombre de patients",
#        y = "Siège actuel des lésions") +
#   theme(legend.position = "none") +
#   scale_y_discrete(limits = rev)  # Pour que la barre la plus haute soit en haut

# fig6 <- 
#   ggplot(data = result4,
#          mapping = aes(y = reorder(sieges, n, .desc = FALSE),
#                        x = n,
#                        fill = sieges)) +
#   geom_col(linewidth = 0.3,
#            color = "white") + 
#   geom_text(mapping = aes(label = n),
#             hjust = -0.5,
#             color = "black",
#             fontface = "bold",
#             size = 4) +
#   labs(x = "Nombre de patients",
#        y = "Siège actuel") +
#   theme(legend.position = "none")
# 
# fig6

fig6 <- 
  ggplot(data = result4,
         mapping = aes(y = reorder(sieges, n, .desc = FALSE),
                       x = n)) +
  geom_col(linewidth = 0.3,
           fill = "#1f78b4",
           color = "white") + 
  geom_text(mapping = aes(label = n,
                          x = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Nombre de patients",
       y = "Siège actuel") +
  theme(legend.position = "none") + 
  theme_minimal()

fig6

```

```{r}
#Saving the figure in a jpg format
ggsave(plot = fig6,
       filename = here("outputs/Figure_6.jpg"),
       width = 10,
       height = 6)
```

```{r}
fig6b <- 
  ggplot(data = result4,
         mapping = aes(y = reorder(sieges, n, .desc = FALSE),
                       x = n)) +
  geom_col(linewidth = 0.3,
           fill = "forestgreen",
           color = "white") + 
  geom_text(mapping = aes(label = n,
                          x = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Nombre de patients",
       y = "Siège actuel") +
  theme(legend.position = "none") + 
  theme_minimal()

fig6b

#Saving the figure in a jpg format
ggsave(plot = fig6b,
       filename = here("outputs/Figure_6b.jpg"),
       width = 10,
       height = 6)
```

Les aisselles représentent le site lésionnel le plus fréquent (n = 41; 83,7%), suivies du pubis (n = 15; 30,6%) et des fesses (n = 12; 24,5%). Un total de 25 patients (51,0%) présentent des lésions sur au moins un site corporel. 

## Types de lésions

```{r}
result5 <- 
  mdv %>% 
  separate_rows(types_de_lesions, sep = "  ") %>% 
  count(types_de_lesions) %>% 
  arrange(desc(n)) %>%
  mutate(pct = round(n/nrow(mdv)*100, digits = 1))

result5 %>% 
  reactable()
         
```

```{r}
# Bar chart displaying the types of lesions
# fig7 <- 
  # ggplot(data = mdv,
  #        mapping = aes(y = fct_infreq(types_de_lesions),
  #                      fill = types_de_lesions)) +
  # geom_bar(color = "white") +
  # geom_text(stat = "count",
  #           mapping = aes(label = ..count..),
  #           color = "black",
  #           hjust = -0.5,
  #           fontface = "bold") +
  # labs(x = "Nombre de patients",
  #      y = "Types de lésions") +
  # theme(legend.position = "none") +
  # scale_y_discrete(limits = rev)  # Pour que la barre la plus haute soit en haut

# fig7 <- 
#   ggplot(data = result5,
#          mapping = aes(y = reorder(types_de_lesions, n, .desc = FALSE),
#                        x = n,
#                        fill = types_de_lesions)) +
#   geom_col(linewidth = 0.3,
#            color = "white") + 
#   geom_text(mapping = aes(label = n),
#             hjust = -0.5,
#             color = "black",
#             fontface = "bold",
#             size = 4) +
#   labs(x = "Nombre de patients",
#        y = "Types de lésions") +
#   theme(legend.position = "none")
# 
# fig7

fig7 <- 
  ggplot(data = result5,
         mapping = aes(y = reorder(types_de_lesions, n, .desc = FALSE),
                       x = n)) +
  geom_col(linewidth = 0.3,
           fill = "#1f78b4",
           color = "white") + 
  geom_text(mapping = aes(label = n,
                          x = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Nombre de patients",
       y = "Types de lésions") +
  theme(legend.position = "none") + 
  theme_minimal()

fig7

```

```{r}
#Saving the figure
ggsave(plot = fig7,
       filename = here("outputs/Figure_7.jpg"),
       width = 10,
       height = 6)
```

```{r}
fig7b <- 
  ggplot(data = result5,
         mapping = aes(y = reorder(types_de_lesions, n, .desc = FALSE),
                       x = n)) +
  geom_col(linewidth = 0.3,
           fill = "forestgreen",
           color = "white") + 
  geom_text(mapping = aes(label = n,
                          x = n/2),
            color = "white",
            fontface = "bold",
            size = 4) +
  labs(x = "Nombre de patients",
       y = "Types de lésions") +
  theme(legend.position = "none") + 
  theme_minimal()

fig7b

#Saving the figure
ggsave(plot = fig7b,
       filename = here("outputs/Figure_7b.jpg"),
       width = 10,
       height = 6)

```

Les nodules représentent la lésion la plus prépondérante, onjectivée chez 39 patients (79,6). Ensuite sont retrouvées les masses abcédées, notamment chez 23 patients (46,9%), et les fistules chez 19 patients (38,8%). Par ailleurs, près de 32 patients (65,3%) ont plus d'un type de lésions.

## Classification clinique de Hurley

```{r}
#Preparing the data for plotting
result6 <- 
  mdv %>% 
  count(classification_de_hurley) %>% 
  mutate(pct = round(n/sum(n)*100, digits = 1),
        #defining the positions for the labels to add
         csum = rev(cumsum(rev(n))), 
         pos = n/2 + lead(csum, 1),
         pos = if_else(is.na(pos), n/2, pos)
         ) 

result6 %>% 
  reactable()

```

```{r}
#Pie chart showing the different clinical stages
fig8 <- 
  ggplot(data = result6,
         mapping = aes(x = 4,
                       y = n,
                       fill = fct_inorder(classification_de_hurley))) +
  geom_col(color = "white",
           linewidth = 1) +
  coord_polar(theta = "y") +
  geom_label_repel(data = result6,
                   aes(y = pos,
                       label = paste0(pct, "%")),
                   size = 4,
                   color = "black",
                   fontface = "bold",
                   nudge_x = 1,
                   show.legend = F) +
  labs(fill = "Classification clinique de Hurley") +
  theme_void() 

fig8

```

```{r}
#Saving Fig 8 in a jpg format
ggsave(plot = fig8,
       filename = here("outputs/Figure_8.jpg"),
       width = 8,
       height = 6)
```

```{r}
fig8b <- 
  ggplot(result6,
         aes(x = 2,
             y = n,
             fill = classification_de_hurley)) +
  geom_col(position = "fill",
           color = "white",
           linewidth = 1) +
  geom_text(aes(label = paste0(pct, "%")), #adding the labels
            position = position_fill(vjust = 0.5),
            color = "black",
            fontface = "bold",
            show.legend = F,
            size = 5
            ) +
  coord_polar(theta = "y") +
  xlim(c(0.2, 2 + 0.5)) +
  labs(fill = "Classification clinique de Hurley") +
  theme_void()

fig8b
```

```{r}
#Saving Fig 9b in a jpg format
ggsave(plot = fig8b,
       filename = here("outputs/Figure_8b.jpg"),
       width = 8,
       height = 6)
```

Plus de la moitié des patients (n = 28; 57,1%) sont au stade 1 de la maladie tandis que 19 patients (38,8%) sont au stade 2. Seuls 2 patients (4,1%) sont au stade 3 de la maladie.

## Qualité de vie

```{r}
# Normality test on QoL
shapiro.test(mdv$total_dlqi) # W = 0.70405, p-value = 3.094e-05

#QoL summary
summary(mdv$total_dlqi)

```

Des 21 patients pour lesquels l'information est disponible, le score DLQI varie de 1 à 13, avec une médiane de 2 (EIQ: 2-4). 

```{r}
#Categorizing the QoL score
mdv <- mdv %>% 
  mutate(
    total_dlqi = as.numeric(total_dlqi),
    qdv = case_when(
    total_dlqi<=1 ~ "QdV non altérée",
    total_dlqi>1 & total_dlqi<6 ~ "Faible altération",
    total_dlqi>5 & total_dlqi<11 ~ "Altération modérée",
    total_dlqi>10 & total_dlqi<21 ~ "Altération importante",
    total_dlqi>20 & total_dlqi<=30 ~ "Altération extrêmement importante",
    TRUE ~ "Données non disponibles"
  ))

#Summary table of QoL categories
mdv %>% 
  count(qdv) %>% 
  mutate(pct = round(n/sum(n)*100, digits = 1)) %>% 
  arrange(desc(n)) %>% 
  reactable()

```

Aucun patient ne présente une altération extrêmement importante. Cependant, 4 patients (8,2%) présentent une altération modérée à importante de la QdV. En outre, 12 patients (24,5%) présentent une faible altération de la QdV tandis que 5 patients (10,2%) ne présentent aucune altération de leur QdV.

```{r}
#Preparing data for plotting
result7 <- 
  mdv %>% 
  filter(!(qdv == "Données non disponibles")) %>% 
  count(qdv) %>% 
  arrange(desc(n)) %>% 
  mutate(qdv = fct_reorder(qdv, n, .desc = TRUE)) %>% 
  mutate(pct = round(n/sum(n)*100, digits = 1),
        #defining the positions for the labels to add
         csum = rev(cumsum(rev(n))), 
         pos = n/2 + lead(csum, 1),
         pos = if_else(is.na(pos), n/2, pos)
         ) 

result7 %>% 
  reactable()
```

```{r}
#Pie chart showing the different levels of altered QoL
fig9 <- 
  ggplot(data = result7,
         mapping = aes(x = 4,
                       y = n,
                       fill = qdv)) +
  geom_col(color = "white",
           linewidth = 1) +
  coord_polar(theta = "y") +
  geom_label_repel(data = result7,
                   aes(y = pos,
                       label = paste0(pct, "%")),
                   size = 4,
                   color = "black",
                   fontface = "bold",
                   nudge_x = 1,
                   show.legend = F) +
  labs(fill = "Qualité de vie") +
  theme_void() 

fig9
```

```{r}
#Saving the figure
ggsave(plot = fig9,
       filename = here("outputs/Figure_9.jpg"),
       width = 8,
       height = 6)
```

```{r}
# Donut chart showing Qualité de vie
 fig9b <- 
  ggplot(result7,
         aes(x = 2,
             y = n,
             fill = qdv)) +
  geom_col(position = "fill",
           color = "white",
           linewidth = 1) +
  geom_text(aes(label = paste0(pct, "%")), #adding the labels
            position = position_fill(vjust = 0.5),
            color = "black",
            fontface = "bold",
            show.legend = F,
            size = 5
            ) +
  coord_polar(theta = "y") +
  xlim(c(0.2, 2 + 0.5)) +
  labs(fill = "Qualité de vie") +
  theme_void()

fig9b
```

```{r}
#Saving the figure
ggsave(plot = fig9b,
       filename = here("outputs/Figure_9b.jpg"),
       width = 8,
       height = 6)
```


# Analyse bivariée

## Relation entre siège de début et siège actuel des lésions

```{r}
# Selecting the two variables for the figure
result5 <- mdv %>% 
  select(siege_de_debut, sieges) %>% 
  group_by(siege_de_debut, sieges) %>% 
  summarise(n = n(), .groups = "drop") 

result5 %>% 
  mutate(pct = round(n/nrow(mdv)*100, digits = 1)) %>% 
  reactable()

```

```{r}
# Alluvial plot or Sankey diagram (Diagramme de Sankey)
fig10 <- 
  ggplot(result5,
       aes(axis1 = siege_de_debut, axis2 = sieges, y = n)) +
  geom_alluvium(aes(fill = siege_de_debut), width = 1/12) +
  geom_stratum(width = 1/12, fill = "white", color = "grey") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Siège de début", "Siège actuel"), expand = c(.1, .1)) +
  theme_void() +
  theme(legend.position = "none")

fig10

```

```{r}
#Saving the figure
ggsave(plot = fig10,
       filename = here("outputs/Figure_10.jpg"),
       width = 8,
       height = 6)
```

Les aisselles comme site initial des lésions le sont restées chez 16 patients (32,7%). En outre, ayant débuté exclusivement aux aisselles, les lésions ont évolué vers au moins un site additionnel chez 10 patients (20,4%).

## Distribution de la QdV selon le sexe

```{r}
#Box plot showing the distribution of QoL by sex
fig11 <- 
  ggplot(data = mdv,
         mapping = aes(y = total_dlqi,
                       x = sexe,
                       fill = sexe)) +
  geom_boxplot(color = "black",
               linewidth = 0.4) + 
  geom_jitter(color = "black",
              width = 0.2,
              size = 1,
              alpha = 0.3) +
  labs(y = "Qualité de vie",
       x = "Sexe",
       fill = "Sexe") + 
  theme_minimal() + 
  theme(legend.position = "none")

fig11

```

```{r}
#Saving the figure
ggsave(plot = fig11,
       filename = here("outputs/Figure_11.jpg"),
       width = 8,
       height = 6)
```

```{r}
# Test de Wilcoxon; pour rappel: variable non ghaussienne
wilcox.test(total_dlqi ~ sexe, data = mdv) ##W = 25.5, p-value = 0.03432, inférieur à 0.05

mdv %>% 
  group_by(sexe) %>% 
  summarise(median = median(total_dlqi, na.rm = TRUE),
            first_q = quantile(total_dlqi, probs = 0.25, na.rm = TRUE),
            third_q = quantile(total_dlqi, probs = 0.75, na.rm = TRUE)) %>% 
  reactable()
```

Une comparaison des scores de qualité de vie entre hommes et femmes montre que les hommes ont une tendance à une altération de qdv plus marquée que chez les femmes, avec une différence statistiquement signficative: médiane 3 (EIQ 2-8) vs 2,0 (EIQ 1-2); p = 0,034 (Figure 10).

## Qualité de vie et stade de la maladie

```{r}
#Box plot showing the distribution of QoL by sex
fig12 <- 
  ggplot(data = mdv,
         mapping = aes(y = total_dlqi,
                       x = classification_de_hurley,
                       fill = classification_de_hurley)) +
  geom_boxplot(color = "black",
               linewidth = 0.4) + 
  geom_jitter(color = "black",
              width = 0.2,
              size = 1,
              alpha = 0.3) +
  labs(y = "Qualité de vie",
       x = "Classification clinique de Hurley") + 
  theme_minimal() + 
  theme(legend.position = "none") 

fig12
```

```{r}
#Saving the figure
ggsave(plot = fig12,
       filename = here("outputs/Figure_12.jpg"),
       width = 8,
       height = 6)
```

```{r}
# Test de Kruskal-Wallis; pour rappel: variable non ghaussienne
kruskal.test(total_dlqi ~ classification_de_hurley, data = mdv) ##Kruskal-Wallis chi-squared = 7.7242, df = 2, p-value = 0.02102
```

```{r}
#Summary of dlqi grouped by stage of disease
mdv %>% 
  group_by(classification_de_hurley) %>% 
  summarise(median = median(total_dlqi, na.rm = TRUE),
            first_q = quantile(total_dlqi, probs = 0.25, na.rm = TRUE),
            third_q = quantile(total_dlqi, probs = 0.75, na.rm = TRUE)) %>% 
  reactable()
```

La figure 12 montre clairement que le score de qualité de vie semble intimement lié au stade de la maladie. En effet, l'altération de la qualité de vie semble s'ampirer avec le stade de la maladie, avec une différence statistiqument significative entre les trois stades: médiane 2 (EIQ 1-2) vs 3 (EIQ 2-4,5) vs 13 (EIQ 13-13) respectivement pour les stades 1, 2 et 3; p = 0,02.

## Corrélation entre qualité de vie et durée d'évolution de la maladie

```{r}
#Removing NAq
mdv_corr <- mdv %>% 
  filter(!is.na(delai_devolution_en_mois)) %>% 
  filter(!is.na(total_dlqi))

#Correlation test 
cor.test(mdv_corr$delai_devolution_en_mois,
         mdv_corr$total_dlqi,
         method = "spearman") # If both variables were normally distributed, you could use method = "pearson" for Pearson's correlation.

# Result rho = 0.08418363; S = 1410.4, p-value = 0.7168
```

```{r}
fig13 <- 
  ggplot(data = mdv_corr,
         mapping = aes(x = delai_devolution_en_mois,
                       y = total_dlqi)) + 
  geom_point(size = 2,
             color = "red") +
  labs(x = "Durée d'évolution de la maladie (mois)",
       y = "Score DLQI mesurant la QdV") + 
  theme_minimal()

fig13
```

```{r}
#Saving the figure
ggsave(plot = fig13,
       filename = here("outputs/Figure_13.jpg"),
       width = 8,
       height = 6)
```

```{r}
summary(mdv$delai_devolution_en_mois)
sd(mdv$delai_devolution_en_mois, na.rm  =T)

mdv %>% 
  filter(collecte_de_donnees == "Prospective") %>% 
  summarise(summary = summary(delai_devolution_en_mois, na.rm = T))
```

## Sexe et sévérité de la maladie

```{r}
# Figure showing classification hurley vs sexe
fig14 <- 
  mdv %>% 
  count(sexe, classification_de_hurley) %>% 
  ggplot(aes(x = classification_de_hurley,
             y = n,
             fill = sexe)) + 
  geom_col(width = 0.3,
           color = "white",
           position  = position_dodge(width = 0.3)) + 
  geom_text(aes(label = n, y = n/2),
            color = "white",
            fontface = "bold",
            size = 4,
            position = position_dodge(width = 0.3)
            ) + 
  labs(x = "Classification clinique de Hurley",
       y = "Nombre de patients",
       fill = "Sexe") + 
  theme_minimal()

fig14

```

```{r}
#Saving the figure
ggsave(plot = fig14,
       filename = here("outputs/Figure_14.jpg"),
       width = 8,
       height = 6)
```

```{r}
fig14b <- 
  mdv %>% 
  count(sexe, classification_de_hurley) %>% 
  ggplot(aes(x = classification_de_hurley,
             y = n,
             fill = sexe)) + 
  geom_col(width = 0.3,
           color = "white",
           position  = "stack") + 
  geom_text(aes(label = n),
            position = position_stack(vjust = 0.5),
            color = "white",
            fontface = "bold",
            size = 4
            ) + 
  labs(x = "Classification clinique de Hurley",
       y = "Nombre de patients",
       fill = "Sexe") + 
  theme_minimal()

fig14b

#Saving the figure
ggsave(plot = fig14b,
       filename = here("outputs/Figure_14b.jpg"),
       width = 8,
       height = 6)
```

La figure 14 montre que des 28 patients au stade I de la maladie, 18 (64,3%) sont de sexe féminin; des 19 patients au stade II, 11 (57,9%) sont de sexe féminin. Les deux patients au stade III sont tous de sexe masculin. Cependant, il n'y avait pas de différence significative entre hommes et femmes vis-à-vis de la sévérité de la maladie (Chi-2 = 3,215; p = 0,200).

```{r}
# Chi square test for severity vs sexe
mdv %>% 
  count(sexe, classification_de_hurley) %>% 
  {chisq.test(xtabs(n ~ sexe + classification_de_hurley, data = .))}
```

## Sexe et facteurs d'exposition

```{r}
fig15 <- 
  mdv %>% 
  mutate(facteurs_de_risque = case_when(
    facteurs_de_risque == "Non précisé" ~ "Non_précisé",
    TRUE ~ facteurs_de_risque
  )) %>% 
  separate_rows(facteurs_de_risque, sep = " ") %>% 
  mutate(facteurs_de_risque = case_when(
    facteurs_de_risque == "Non_précisé" ~ "Non précisé",
    TRUE ~ facteurs_de_risque
  )) %>% 
#Preparing the data for plotting
  count(facteurs_de_risque, sexe) %>% 
  ggplot(aes(x = facteurs_de_risque,
             y = n,
             fill = sexe)) + 
  geom_col(width = 0.3,
           color = "white",
           position  = position_dodge(width = 0.3)) + 
  geom_text(aes(label = n, y = n/2),
            color = "white",
            fontface = "bold",
            size = 4,
            position = position_dodge(width = 0.3)
            ) + 
  labs(x = "Facteurs d'exposition",
       y = "Nombre de patients",
       fill = "Sexe") + 
  theme_minimal()

fig15
  
```

```{r}
#Saving the figure
ggsave(plot = fig15,
       filename = here("outputs/Figure_15.jpg"),
       width = 8,
       height = 6)
```

```{r}
fig15b <- 
  mdv %>% 
  mutate(facteurs_de_risque = case_when(
    facteurs_de_risque == "Non précisé" ~ "Non_précisé",
    TRUE ~ facteurs_de_risque
  )) %>% 
  separate_rows(facteurs_de_risque, sep = " ") %>% 
  mutate(facteurs_de_risque = case_when(
    facteurs_de_risque == "Non_précisé" ~ "Non précisé",
    TRUE ~ facteurs_de_risque
  )) %>% 
#Preparing the data for plotting
  count(facteurs_de_risque, sexe) %>% 
  ggplot(aes(x = facteurs_de_risque,
             y = n,
             fill = sexe)) + 
  geom_col(width = 0.3,
           color = "white",
           position  = "stack") + 
  geom_text(aes(label = n),
            position = position_stack(vjust = 0.5),
            color = "white",
            fontface = "bold",
            size = 4
            ) + 
  labs(x = "Facteurs d'exposition",
       y = "Nombre de patients",
       fill = "Sexe") + 
  theme_minimal()

fig15b
```

```{r}
#Saving the figure
ggsave(plot = fig15b,
       filename = here("outputs/Figure_15b.jpg"),
       width = 8,
       height = 6)
```

```{r}
# Chi square test for severity vs sexe
mdv %>% 
  count(sexe, facteurs_de_risque) %>% 
  {chisq.test(xtabs(n ~ sexe + facteurs_de_risque, data = .))}
```

Des 7 et 5 patients présentant une obésité et des antécédents familiaux de MDV, 4 (57,1% et 80,0% respectivement) étaient des femmes tandis que des 4 patients fumeurs, 3 (75,0%) étaient des hommes. Il n'y a pas de différence entre hommes et femmes sur les facteurs d'exposition (Chi-2 = 5,10; p = 0,404). 

## Facteurs d'exposition et QdV

```{r}
fig16 <- 
mdv %>% 
  mutate(facteurs_de_risque = case_when(
    facteurs_de_risque == "Non précisé" ~ "Non_précisé",
    TRUE ~ facteurs_de_risque
  )) %>% 
  separate_rows(facteurs_de_risque, sep = " ") %>% 
  mutate(facteurs_de_risque = case_when(
    facteurs_de_risque == "Non_précisé" ~ "Non précisé",
    TRUE ~ facteurs_de_risque)) %>% 
  filter(facteurs_de_risque == c("Obésité", "Hérédité", "Tabac")) %>% 
  ggplot(aes(x = facteurs_de_risque,
             y = total_dlqi,
             fill = facteurs_de_risque)) +
  geom_boxplot(color = "black",
               linewidth = 0.4) + 
  geom_jitter(color = "black",
              width = 0.2,
              size = 1,
              alpha = 0.3) +
  labs(y = "Qualité de vie",
       x = "Facteurs d'exposition") + 
  theme_minimal() + 
  theme(legend.position = "none") 

fig16
      
```

```{r}
#Saving the figure
ggsave(plot = fig16,
       filename = here("outputs/Figure_16.jpg"),
       width = 8,
       height = 6)
```

```{r}
# Test de Kruskal-Wallis; pour rappel: variable non ghaussienne
kruskal.test(total_dlqi ~ facteurs_de_risque, data = mdv) # Kruskal-Wallis chi-squared = 2.1317, df = 4, p-value = 0.7115
```

La figure 16 montre qu'il n'y a pas de différence dans l'altération de la qualité de vie entre les patients ayant les trois comorbidités répertoriées, notamment obésité, tabac et hérédité/ATCD familiaux de MDV (p = 0,712).
